using System;
using System.Collections.Generic;
using System.Text;
using System.Net;
using System.Collections.Specialized;

namespace Updater
{
    class Reporter
    {
        private DataLogger dataLogger;
        private static string POSTURL = "http://requestb.in/18j1ix61";

        private string prepareData()
        {
            Dictionary<string, string> loggerData = this.dataLogger.getData();

            string json = "{";
            int counter = 0;
            foreach (KeyValuePair<string, string> entry in loggerData)
            {
                json += "\"" + entry.Key + "\": \"" + entry.Value + "\"";
                counter++;
                if (counter < loggerData.Count)
                {
                    json += ",";
                }
            }
            return json + "}";
        }

        private void sendReport()
        {
            using (var client = new WebClient())
            {
                string values = this.prepareData();                
                var response = client.UploadString(POSTURL, values);
                var responseString = response;
            }
        }

        public Reporter (DataLogger dataLogger)
        {
            this.dataLogger = dataLogger;
            this.sendReport();
        }
    }
}
